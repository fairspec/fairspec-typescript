{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "allOf": [{ "$ref": "#/$defs/TableSchema" }],
  "$defs": {
    "TableSchema": {
      "type": "object",
      "properties": {
        "$schema": { "$ref": "#/$defs/MetaSchema" },
        "title": { "$ref": "#/$defs/Title" },
        "description": { "$ref": "#/$defs/Description" },
        "required": { "$ref": "#/$defs/Required" },
        "properties": { "$ref": "#/$defs/Properties" },
        "missingValues": { "$ref": "#/$defs/MissingValues" },
        "primaryKey": { "$ref": "#/$defs/PrimaryKey" },
        "uniqueKeys": { "$ref": "#/$defs/UniqueKeys" },
        "foreignKeys": { "$ref": "#/$defs/ForeignKeys" }
      }
    },
    "MetaSchema": {
      "type": "string",
      "pattern": "table.json$"
    },
    "Title": {
      "type": "string"
    },
    "Description": {
      "type": "string"
    },
    "Required": {
      "type": "array",
      "items": { "type": "string" }
    },
    "Properties": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/$defs/ColumnProperty"
      }
    },
    "ColumnProperty": {
      "required": ["type"],
      "properties": {
        "type": {
          "enum": ["string", "integer", "number", "boolean", "array", "object"]
        }
      },
      "allOf": [
        {
          "if": { "properties": { "type": { "const": "boolean" } } },
          "then": { "$ref": "#/$defs/BooleanColumnPropertyGroup" }
        },
        {
          "if": { "properties": { "type": { "const": "integer" } } },
          "then": { "$ref": "#/$defs/IntegerColumnPropertyGroup" }
        },
        {
          "if": { "properties": { "type": { "const": "number" } } },
          "then": { "$ref": "#/$defs/NumberColumnPropertyGroup" }
        },
        {
          "if": { "properties": { "type": { "const": "string" } } },
          "then": { "$ref": "#/$defs/StringColumnPropertyGroup" }
        },
        {
          "if": { "properties": { "type": { "const": "array" } } },
          "then": { "$ref": "#/$defs/ArrayColumnPropertyGroup" }
        },
        {
          "if": { "properties": { "type": { "const": "object" } } },
          "then": { "$ref": "#/$defs/ObjectColumnPropertyGroup" }
        }
      ]
    },
    "BooleanColumnPropertyGroup": {
      "allOf": [
        {
          "if": { "not": { "required": ["format"] } },
          "then": { "$ref": "#/$defs/BooleanColumnProperty" }
        }
      ]
    },
    "IntegerColumnPropertyGroup": {
      "allOf": [
        {
          "if": { "not": { "required": ["format"] } },
          "then": { "$ref": "#/$defs/IntegerColumnProperty" }
        },
        {
          "if": { "properties": { "format": { "const": "categorical" } } },
          "then": { "$ref": "#/$defs/IntegerCategoricalColumnProperty" }
        }
      ]
    },
    "NumberColumnPropertyGroup": {
      "allOf": [
        {
          "if": { "not": { "required": ["format"] } },
          "then": { "$ref": "#/$defs/NumberColumnProperty" }
        }
      ]
    },
    "StringColumnPropertyGroup": {
      "properties": {
        "format": {
          "enum": [
            "list",
            "hex",
            "base64",
            "email",
            "url",
            "date-time",
            "date",
            "time",
            "duration",
            "wkt",
            "wkb"
          ]
        }
      },
      "allOf": [
        {
          "if": { "not": { "required": ["format"] } },
          "then": { "$ref": "#/$defs/StringColumnProperty" }
        },
        {
          "if": { "properties": { "format": { "const": "categorical" } } },
          "then": { "$ref": "#/$defs/StringCategoricalColumnProperty" }
        },
        {
          "if": { "properties": { "format": { "const": "list" } } },
          "then": { "$ref": "#/$defs/ListColumnProperty" }
        },
        {
          "if": { "properties": { "format": { "const": "hex" } } },
          "then": { "$ref": "#/$defs/HexColumnProperty" }
        },
        {
          "if": { "properties": { "format": { "const": "base64" } } },
          "then": { "$ref": "#/$defs/Base64ColumnProperty" }
        },
        {
          "if": { "properties": { "format": { "const": "email" } } },
          "then": { "$ref": "#/$defs/EmailColumnProperty" }
        },
        {
          "if": { "properties": { "format": { "const": "url" } } },
          "then": { "$ref": "#/$defs/UrlColumnProperty" }
        },
        {
          "if": { "properties": { "format": { "const": "date-time" } } },
          "then": { "$ref": "#/$defs/DatetimeColumnProperty" }
        },
        {
          "if": { "properties": { "format": { "const": "date" } } },
          "then": { "$ref": "#/$defs/DateColumnProperty" }
        },
        {
          "if": { "properties": { "format": { "const": "time" } } },
          "then": { "$ref": "#/$defs/TimeColumnProperty" }
        },
        {
          "if": { "properties": { "format": { "const": "duration" } } },
          "then": { "$ref": "#/$defs/DurationColumnProperty" }
        },
        {
          "if": { "properties": { "format": { "const": "wkt" } } },
          "then": { "$ref": "#/$defs/WktColumnProperty" }
        },
        {
          "if": { "properties": { "format": { "const": "wkb" } } },
          "then": { "$ref": "#/$defs/WkbColumnProperty" }
        }
      ]
    },
    "ArrayColumnPropertyGroup": {
      "allOf": [
        {
          "if": { "not": { "required": ["format"] } },
          "then": { "$ref": "#/$defs/ArrayColumnProperty" }
        }
      ]
    },
    "ObjectColumnPropertyGroup": {
      "properties": {
        "format": {
          "enum": ["geojson", "topojson"]
        }
      },
      "allOf": [
        {
          "if": { "not": { "required": ["format"] } },
          "then": { "$ref": "#/$defs/ObjectColumnProperty" }
        },
        {
          "if": { "properties": { "format": { "const": "geojson" } } },
          "then": { "$ref": "#/$defs/GeojsonColumnProperty" }
        },
        {
          "if": { "properties": { "format": { "const": "topojson" } } },
          "then": { "$ref": "#/$defs/TopojsonColumnProperty" }
        }
      ]
    },
    "BaseColumnProperty": {
      "type": "object",
      "properties": {
        "title": { "$ref": "#/$defs/Title" },
        "description": { "$ref": "#/$defs/Description" },
        "rdfType": { "$ref": "#/$defs/RdfType" }
      }
    },
    "BooleanColumnProperty": {
      "allOf": [{ "$ref": "#/$defs/BaseColumnProperty" }],
      "properties": {
        "type": { "const": "boolean" },
        "enum": { "$ref": "#/$defs/BooleanEnum" },
        "examples": { "$ref": "#/$defs/BooleanExamples" },
        "missingValues": { "$ref": "#/$defs/MissingValues" },
        "trueValues": { "$ref": "#/$defs/TrueValues" },
        "falseValues": { "$ref": "#/$defs/FalseValues" }
      }
    },
    "BaseIntegerColumnProperty": {
      "allOf": [{ "$ref": "#/$defs/BaseColumnProperty" }],
      "properties": {
        "type": { "const": "integer" },
        "enum": { "$ref": "#/$defs/IntegerEnum" },
        "examples": { "$ref": "#/$defs/IntegerExamples" },
        "missingValues": { "$ref": "#/$defs/IntegerMissingValues" },
        "minimum": { "$ref": "#/$defs/IntegerMinimum" },
        "maximum": { "$ref": "#/$defs/IntegerMaximum" },
        "exclusiveMinimum": { "$ref": "#/$defs/IntegerExclusiveMinimum" },
        "exclusiveMaximum": { "$ref": "#/$defs/IntegerExclusiveMaximum" },
        "multipleOf": { "$ref": "#/$defs/IntegerMultipleOf" },
        "groupChar": { "$ref": "#/$defs/GroupChar" },
        "withText": { "type": "boolean" },
        "categories": { "$ref": "#/$defs/IntegerCategories" },
        "categoriesOrdered": { "type": "boolean" }
      }
    },
    "IntegerColumnProperty": {
      "allOf": [{ "$ref": "#/$defs/BaseIntegerColumnProperty" }]
    },
    "IntegerCategoricalColumnProperty": {
      "allOf": [{ "$ref": "#/$defs/BaseIntegerColumnProperty" }],
      "properties": {
        "format": { "const": "categorical" },
        "categories": { "$ref": "#/$defs/IntegerCategories" },
        "withOrder": { "type": "boolean" }
      }
    },
    "NumberColumnProperty": {
      "allOf": [{ "$ref": "#/$defs/BaseColumnProperty" }],
      "properties": {
        "type": { "const": "number" },
        "enum": { "$ref": "#/$defs/NumberEnum" },
        "examples": { "$ref": "#/$defs/NumberExamples" },
        "missingValues": { "$ref": "#/$defs/MissingValues" },
        "minimum": { "$ref": "#/$defs/NumberMinimum" },
        "maximum": { "$ref": "#/$defs/NumberMaximum" },
        "exclusiveMinimum": { "$ref": "#/$defs/NumberExclusiveMinimum" },
        "exclusiveMaximum": { "$ref": "#/$defs/NumberExclusiveMaximum" },
        "multipleOf": { "$ref": "#/$defs/NumberMultipleOf" },
        "decimalChar": { "$ref": "#/$defs/DecimalChar" },
        "groupChar": { "$ref": "#/$defs/GroupChar" },
        "withText": { "type": "boolean" }
      }
    },
    "BaseStringColumnProperty": {
      "allOf": [{ "$ref": "#/$defs/BaseColumnProperty" }],
      "properties": {
        "type": { "const": "string" },
        "enum": { "$ref": "#/$defs/StringEnum" },
        "examples": { "$ref": "#/$defs/StringExamples" },
        "missingValues": { "$ref": "#/$defs/StringMissingValues" },
        "minLength": { "$ref": "#/$defs/MinLength" },
        "maxLength": { "$ref": "#/$defs/MaxLength" },
        "pattern": { "$ref": "#/$defs/Pattern" }
      }
    },
    "StringColumnProperty": {
      "allOf": [{ "$ref": "#/$defs/BaseStringColumnProperty" }],
      "properties": {
        "categories": { "$ref": "#/$defs/StringCategories" },
        "categoriesOrdered": { "type": "boolean" }
      }
    },
    "StringCategoricalColumnProperty": {
      "allOf": [{ "$ref": "#/$defs/BaseStringColumnProperty" }],
      "properties": {
        "format": { "const": "categorical" },
        "categories": { "$ref": "#/$defs/StringCategories" },
        "withOrder": { "type": "boolean" }
      }
    },
    "ListColumnProperty": {
      "allOf": [{ "$ref": "#/$defs/BaseStringColumnProperty" }],
      "properties": {
        "format": { "const": "list" },
        "itemType": { "$ref": "#/$defs/ListItemType" },
        "delimiter": { "$ref": "#/$defs/ListDelimiter" }
      }
    },
    "Base64ColumnProperty": {
      "allOf": [{ "$ref": "#/$defs/BaseStringColumnProperty" }],
      "properties": {
        "format": { "const": "base64" }
      }
    },
    "HexColumnProperty": {
      "allOf": [{ "$ref": "#/$defs/BaseStringColumnProperty" }],
      "properties": {
        "format": { "const": "hex" }
      }
    },
    "EmailColumnProperty": {
      "allOf": [{ "$ref": "#/$defs/BaseStringColumnProperty" }],
      "properties": {
        "format": { "const": "email" }
      }
    },
    "UrlColumnProperty": {
      "allOf": [{ "$ref": "#/$defs/BaseStringColumnProperty" }],
      "properties": {
        "format": { "const": "url" }
      }
    },
    "DatetimeColumnProperty": {
      "allOf": [{ "$ref": "#/$defs/BaseStringColumnProperty" }],
      "properties": {
        "format": { "const": "date-time" },
        "temporalFormat": { "$ref": "#/$defs/TemporalFormat" }
      }
    },
    "DateColumnProperty": {
      "allOf": [{ "$ref": "#/$defs/BaseStringColumnProperty" }],
      "properties": {
        "format": { "const": "date" },
        "temporalFormat": { "$ref": "#/$defs/TemporalFormat" }
      }
    },
    "TimeColumnProperty": {
      "allOf": [{ "$ref": "#/$defs/BaseStringColumnProperty" }],
      "properties": {
        "format": { "const": "time" },
        "temporalFormat": { "$ref": "#/$defs/TemporalFormat" }
      }
    },
    "DurationColumnProperty": {
      "allOf": [{ "$ref": "#/$defs/BaseStringColumnProperty" }],
      "properties": {
        "format": { "const": "duration" }
      }
    },
    "WktColumnProperty": {
      "allOf": [{ "$ref": "#/$defs/BaseStringColumnProperty" }],
      "properties": {
        "format": { "const": "wkt" }
      }
    },
    "WkbColumnProperty": {
      "allOf": [{ "$ref": "#/$defs/BaseStringColumnProperty" }],
      "properties": {
        "format": { "const": "wkb" }
      }
    },
    "ArrayColumnProperty": {
      "allOf": [
        { "$ref": "#/$defs/BaseColumnProperty" },
        { "$ref": "https://json-schema.org/draft/2020-12/schema" }
      ],
      "type": "array",
      "properties": {
        "enum": { "$ref": "#/$defs/ArrayEnum" },
        "examples": { "$ref": "#/$defs/ArrayExamples" },
        "missingValues": { "$ref": "#/$defs/StringMissingValues" }
      }
    },
    "BaseObjectColumnProperty": {
      "allOf": [{ "$ref": "#/$defs/BaseColumnProperty" }],
      "type": "object",
      "properties": {
        "enum": { "$ref": "#/$defs/ObjectEnum" },
        "examples": { "$ref": "#/$defs/ObjectExamples" },
        "missingValues": { "$ref": "#/$defs/StringMissingValues" }
      }
    },
    "ObjectColumnProperty": {
      "allOf": [
        { "$ref": "#/$defs/BaseObjectColumnProperty" },
        { "$ref": "https://json-schema.org/draft/2020-12/schema" }
      ]
    },
    "GeojsonColumnProperty": {
      "allOf": [{ "$ref": "#/$defs/BaseObjectColumnProperty" }],
      "properties": {
        "format": { "const": "geojson" }
      }
    },
    "TopojsonColumnProperty": {
      "allOf": [{ "$ref": "#/$defs/BaseObjectColumnProperty" }],
      "properties": {
        "format": { "const": "topojson" }
      }
    },
    "RdfType": {
      "type": "string",
      "format": "uri"
    },
    "Pattern": {
      "type": "string",
      "format": "regex"
    },
    "MinLength": {
      "type": "integer",
      "minimum": 0
    },
    "MaxLength": {
      "type": "integer",
      "minimum": 0
    },
    "TrueValues": {
      "type": "array",
      "items": { "type": "string" }
    },
    "FalseValues": {
      "type": "array",
      "items": { "type": "string" }
    },
    "IntegerMinimum": {
      "type": "integer"
    },
    "IntegerMaximum": {
      "type": "integer"
    },
    "IntegerExclusiveMinimum": {
      "type": "integer"
    },
    "IntegerExclusiveMaximum": {
      "type": "integer"
    },
    "IntegerMultipleOf": {
      "type": "integer",
      "minimum": 1
    },
    "NumberMinimum": {
      "type": "number"
    },
    "NumberMaximum": {
      "type": "number"
    },
    "NumberExclusiveMinimum": {
      "type": "number"
    },
    "NumberExclusiveMaximum": {
      "type": "number"
    },
    "NumberMultipleOf": {
      "type": "number",
      "exclusiveMinimum": 0
    },
    "DecimalChar": {
      "type": "string",
      "maxLength": 1
    },
    "GroupChar": {
      "type": "string",
      "maxLength": 1
    },
    "TemporalFormat": {
      "type": "string"
    },
    "ListDelimiter": {
      "type": "string",
      "maxLength": 1
    },
    "ListItemType": {
      "enum": [
        "string",
        "integer",
        "number",
        "boolean",
        "datetime",
        "date",
        "time"
      ]
    },
    "PrimaryKey": {
      "type": "array",
      "items": { "type": "string" },
      "minItems": 1
    },
    "UniqueKeys": {
      "type": "array",
      "items": { "$ref": "#/$defs/UniqueKey" },
      "minItems": 1
    },
    "UniqueKey": {
      "type": "array",
      "items": { "type": "string" },
      "minItems": 1
    },
    "ForeignKeys": {
      "type": "array",
      "items": { "$ref": "#/$defs/ForeignKey" },
      "minItems": 1
    },
    "ForeignKey": {
      "type": "object",
      "required": ["columns", "reference"],
      "properties": {
        "columns": { "$ref": "#/$defs/ForeignKeyColumns" },
        "reference": { "$ref": "#/$defs/ForeignKeyReference" }
      }
    },
    "ForeignKeyReference": {
      "type": "object",
      "required": ["columns"],
      "properties": {
        "resource": { "type": "string" },
        "columns": { "$ref": "#/$defs/ForeignKeyColumns" }
      }
    },
    "ForeignKeyColumns": {
      "type": "array",
      "items": { "type": "string" }
    },
    "MissingValues": {
      "type": "array",
      "items": {
        "oneOf": [
          { "type": ["string", "integer"] },
          {
            "type": "object",
            "properties": {
              "value": { "type": ["string", "integer"] },
              "label": { "type": "string" }
            }
          }
        ]
      }
    },
    "StringMissingValues": {
      "type": "array",
      "items": {
        "oneOf": [
          { "type": "string" },
          {
            "type": "object",
            "properties": {
              "value": { "type": "string" },
              "label": { "type": "string" }
            }
          }
        ]
      }
    },
    "BooleanExamples": {
      "type": "array",
      "items": { "type": "boolean" }
    },
    "IntegerExamples": {
      "type": "array",
      "items": { "type": "integer" }
    },
    "NumberExamples": {
      "type": "array",
      "items": { "type": "number" }
    },
    "StringExamples": {
      "type": "array",
      "items": { "type": "string" }
    },
    "ArrayExamples": {
      "type": "array",
      "items": { "type": "array" }
    },
    "ObjectExamples": {
      "type": "array",
      "items": { "type": "object" }
    },
    "BooleanEnum": {
      "type": "array",
      "items": { "type": "boolean" }
    },
    "IntegerEnum": {
      "type": "array",
      "items": { "type": "integer" }
    },
    "NumberEnum": {
      "type": "array",
      "items": { "type": "number" }
    },
    "StringEnum": {
      "type": "array",
      "items": { "type": "string" }
    },
    "ArrayEnum": {
      "type": "array",
      "items": { "type": "array" }
    },
    "ObjectEnum": {
      "type": "array",
      "items": { "type": "object" }
    },
    "IntegerCategories": {
      "type": "array",
      "items": {
        "oneOf": [
          { "type": "integer" },
          {
            "type": "object",
            "properties": {
              "value": { "type": "integer" },
              "label": { "type": "string" }
            }
          }
        ]
      }
    },
    "StringCategories": {
      "type": "array",
      "items": {
        "oneOf": [
          { "type": "string" },
          {
            "type": "object",
            "properties": {
              "value": { "type": "string" },
              "label": { "type": "string" }
            }
          }
        ]
      }
    }
  }
}
